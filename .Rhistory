System = "Human Development",
Area = "Healthy Family and Individuals",
Metric = "Health Index",
Measure = "Z",
Source = "CDC PLACES",
Year = 2023,
BiggerBetter = 0
); join_list <- unique(c(join_list, list(HD_HFI_health_index_place))
); join_list <- unique(c(join_list, list(HD_HFI_health_index_tract %>% select(-totalpop, -city))))
public_transit <- c(
31,32,33,36,37,38,39
)
private_transit <- c(
10,11,12,13,14,15,20,38,50,60
)
HD_Tr_public_transit_commute_0 <- pums %>% # (reported commute larger than 45 min)
left_join(target_PUMAs %>% st_drop_geometry(), by = "GEOID", suffix = c("", "_target")) %>%
filter(
TRANWORK %in% public_transit,
!is.na(PUMACE20)
) %>%
mutate(
longcommute = TRANTIME >= 45
); HD_Tr_public_transit_commute_place <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID.y,
weight = PERWT) %>%
mutate(GEOID.y = as.factor(GEOID.y),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID.y,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID.y,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
longcommute == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID.y,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
select(all_of(keeps)) %>%
mutate(City = target_cities$cityst[match(.data$GEOID, target_cities$GEOID)],
Geography = "Place",
System = "Human Development",
Area = "Transportation",
Metric = "Percent of public transit commutes longer than 45 min",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 0
); HD_Tr_public_transit_commute_PUMA <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID,
weight = PERWT) %>%
mutate(GEOID = as.factor(GEOID),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_public_transit_commute_0,
y = longcommute,
x = GEOID,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
longcommute == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
select(all_of(keeps)) %>%
mutate(City = target_PUMAs$cityst[match(.data$GEOID, target_PUMAs$GEOID)],
Geography = "PUMA",
System = "Human Development",
Area = "Transportation",
Metric = "Percent of public transit commutes longer than 45 min",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 0
); join_list <- unique(c(join_list, list(HD_Tr_public_transit_commute_place), list(HD_Tr_public_transit_commute_PUMA)))
HD_Tr_private_transit_commute_0 <- pums %>%
left_join(target_PUMAs %>% st_drop_geometry(), by = "GEOID", suffix = c("", "_target")) %>%
filter(
TRANWORK %in% private_transit,
!is.na(PUMACE20)
) %>%
mutate(
longcommute = TRANTIME >= 45
); HD_Tr_private_transit_commute_place <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID.y,
weight = PERWT) %>%
mutate(GEOID.y = as.factor(GEOID.y),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID.y,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID.y,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
longcommute == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID.y,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
mutate(City = target_cities$cityst[match(.data$GEOID, target_cities$GEOID)],
Geography = "Place",
System = "Human Development",
Area = "Transportation",
Metric = "Percent of private transit commutes longer than 45 min",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 0
); HD_Tr_private_transit_commute_PUMA <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID,
weight = PERWT) %>%
mutate(GEOID = as.factor(GEOID),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_private_transit_commute_0,
y = longcommute,
x = GEOID,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
longcommute == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
select(all_of(keeps)) %>%
mutate(City = target_PUMAs$cityst[match(.data$GEOID, target_PUMAs$GEOID)],
Geography = "PUMA",
System = "Human Development",
Area = "Transportation",
Metric = "Percent of private transit commutes longer than 45 min",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 0
); join_list <- unique(c(join_list, list(HD_Tr_private_transit_commute_place), list(HD_Tr_private_transit_commute_PUMA)))
HD_Tr_pct_public_commute_0 <- pums %>%
left_join(target_PUMAs %>% st_drop_geometry(), by = "GEOID", suffix = c("", "_target")) %>%
filter(
TRANWORK != 0,
!is.na(PUMACE20)
) %>%
mutate(
pubtrans = TRANWORK %in% public_transit
); HD_Tr_pct_public_commute_place <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID.y,
weight = PERWT) %>%
mutate(GEOID.y = as.factor(GEOID.y),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID.y,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID.y,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
pubtrans == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID.y,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
mutate(City = target_cities$cityst[match(.data$GEOID, target_cities$GEOID)],
Geography = "Place",
System = "Human Development",
Area = "Transportation",
Metric = "Percent commuting by public transit",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 1
); HD_Tr_pct_public_commute_PUMA <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID,
weight = PERWT) %>%
mutate(GEOID = as.factor(GEOID),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_pct_public_commute_0,
y = pubtrans,
x = GEOID,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
pubtrans == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
mutate(City = target_PUMAs$cityst[match(.data$GEOID, target_PUMAs$GEOID)],
Geography = "PUMA",
System = "Human Development",
Area = "Transportation",
Metric = "Percent commuting by public transit",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 1
); join_list <- unique(c(join_list, list(HD_Tr_pct_public_commute_place), list(HD_Tr_pct_public_commute_PUMA)))
HD_Tr_pct_private_commute_0 <- pums %>%
left_join(target_PUMAs %>% st_drop_geometry(), by = "GEOID", suffix = c("", "_target")) %>%
filter(
TRANWORK != 0,
!is.na(PUMACE20)
) %>%
mutate(
privtrans = TRANWORK %in% private_transit
); HD_Tr_pct_private_commute_place <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID.y,
weight = PERWT) %>%
mutate(GEOID.y = as.factor(GEOID.y),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID.y,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID.y,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
privtrans == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID.y,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
mutate(City = target_cities$cityst[match(.data$GEOID, target_cities$GEOID)],
Geography = "Place",
System = "Human Development",
Area = "Transportation",
Metric = "Percent commuting by private transit",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 1
); HD_Tr_pct_private_commute_PUMA <-
bind_rows(
pollster::moe_crosstab(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID,
weight = PERWT) %>%
mutate(GEOID = as.factor(GEOID),
raceeth = "all"),
pollster::moe_crosstab_3way(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID,
z = RACEON,
weight = PERWT) %>%
rename(
raceeth = RACEON
),
pollster::moe_crosstab_3way(
HD_Tr_pct_private_commute_0,
y = privtrans,
x = GEOID,
z = hisp,
weight = PERWT) %>%
rename(
raceeth = hisp
),
) %>%
filter(
privtrans == T,
raceeth != "!latino"
) %>%
mutate(pct = pct/100) %>%
select(
raceeth,
GEOID = GEOID,
pct
) %>%
pivot_wider(
names_from = raceeth,
values_from = pct
) %>%
mutate(City = target_PUMAs$cityst[match(.data$GEOID, target_PUMAs$GEOID)],
Geography = "PUMA",
System = "Human Development",
Area = "Transportation",
Metric = "Percent commuting by private transit",
Measure = "%",
Source = "PUMS",
Year = 2022,
BiggerBetter = 1
); join_list <- unique(c(join_list, list(HD_Tr_pct_private_commute_place), list(HD_Tr_pct_private_commute_PUMA)))
df <- bind_rows(join_list)
dallas_only <- df %>%
filter(Geography %in% c("Place", "CSA")) %>%
mutate_all(~ifelse(is.nan(.), NA, .)) %>%
filter(!is.na(all)) %>%
group_by(System, Area, Metric, Measure) %>%
mutate(
DallasRank = case_when(
BiggerBetter == 1 ~ rank(-all),
TRUE ~ rank(all)
),
Ranked = max(DallasRank, na.rm = TRUE),
) %>%
ungroup() %>%
filter(City == "Dallas, TX") %>%
select(System, Area, Metric, Measure, Dallas = all, DallasRank, Ranked)
peer_medians <- df %>%
filter(Geography %in% c("Place", "CSA")) %>%
group_by(System, Area, Metric, Measure) %>%
summarize(
PeerMedian = median(all, na.rm = TRUE),
BestPeer = case_when(
sum(!is.na(all)) == 0 ~ NA,
BiggerBetter == 1 ~ max(all, na.rm = TRUE),
BiggerBetter == 0 ~ min(all, na.rm = TRUE),
TRUE ~ NA
)
) %>%
ungroup() %>%
distinct() %>%
left_join(dallas_only)
write_csv(peer_medians, "data/peer_medians.csv")
geographies <- c(
"Block group" = 1,
"Tract" = 2,
"PUMA" = 3,
"Place" = 4,
"CSA" = 5,
"County" = 6
)
smallgeo <- df %>%
mutate(
geolevel = geographies[Geography]
) %>%
group_by(System, Area, Metric, Measure) %>%
filter(geolevel == min(geolevel))
write_csv(smallgeo %>% distinct(Geography), "data/smallest_geo_available.csv")
dallas_smallgeo <- smallgeo %>%
filter(City == "Dallas, TX")
write_csv(dallas_smallgeo, "data/dallas_smallgeo.csv")
